<div class="panel-header">
    <h2>Admin Dashboard</h2>
</div>

<div class="content-scroll-area admin-forms">

    <div class="admin-section">
        <h3>Bulk Upload Cands (JSON) <button id="toggle-json-sample" class="link-btn">Show Sample</button></h3>
        <p>This will <strong>delete all existing</strong> canned responses and replace them with the content of the file.</p>

        <div id="json-sample" style="display: none;">
            <p>Your file must be a JSON object with a single key "categories", which is an array of category objects, like this:</p>
            <pre class="code-block">
{
  "categories": [
    {
      "title": "Category Title One",
      "templates": [
        {
          "tags": ["tag1", "tag2"],
          "text": "This is the first canned response text."
        },
        {
          "tags": ["tag1", "tag3"],
          "text": "This is the second canned response text."
        }
      ]
    },
    {
      "title": "Category Title Two",
      "templates": [
        {
          "tags": ["tag4"],
          "text": "Another response in a different category."
        }
      ]
    }
  ]
}
            </pre>
        </div>

        <form id="bulk-upload-form" enctype="multipart/form-data">
            <input type="file" name="jsonFile" id="jsonFile" accept=".json" required>
            <button type="submit" class="action-btn">Upload and Reset</button>
        </form>
    </div>

    <div class="admin-section">
        <h3>Bulk Create Users</h3>
        <p>Enter usernames, one per line. Passwords will initially match the username (change after creation).</p>
        <form id="bulk-user-form">
            <textarea id="bulk-usernames" rows="5" placeholder="user1&#10;user2&#10;user3"></textarea>
            <button type="submit" class="action-btn">Create Users</button>
        </form>
        <div id="bulk-user-results" class="results-box" style="display:none;">
            <h4>Generated Credentials <button id="copy-creds-btn" class="action-btn">Copy All</button></h4>
            <pre id="new-creds-output"></pre>
        </div>
    </div>

    <div class="admin-section">
        <h3>User Management</h3>
        <p>Manage user accounts, change roles, set or reset passwords, and delete users. Admin only.</p>

        <div class="user-controls" style="display:flex;gap:10px;align-items:center;margin-bottom:12px;">
            <button id="refreshUsersBtn" class="action-btn">Refresh Users</button>
            <button id="refreshLogsBtn" class="action-btn">Refresh Logs</button>
            <button id="cleanupLogsBtn" class="action-btn">Cleanup Logs</button>
            <div style="margin-left:auto">
                <input id="admin-user-search" type="search" placeholder="Filter users..." style="padding:6px;border-radius:6px;border:1px solid #ddd">
            </div>
        </div>

        <!-- Users list table (client script will populate rows) -->
        <div id="admin-users-container" class="panel" style="padding:0;min-height:120px;">
            <table id="admin-users-table" aria-describedby="admin-users-desc">
                <caption id="admin-users-desc" class="small-muted" style="text-align:left;padding:10px;">List of users. Click the eye to generate and view a temporary password (secure: will be shown once).</caption>
                <thead>
                    <tr>
                        <th style="width:22%;">Username</th>
                        <th style="width:22%;">Password</th>
                        <th style="width:18%;">Role</th>
                        <th style="width:18%;">Modified At</th>
                        <th style="width:20%;">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-users-table-body">
                    <!-- Rows will be rendered here by client script (fetchAndRenderAdminUsers) -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="admin-section">
        <h3>Logs</h3>
        <p>View recent application logs. Use <em>Refresh Logs</em> to fetch latest.</p>
        <div id="log-list" class="panel" style="padding:12px;min-height:160px;">
            <p class="small">No logs loaded. Click "Refresh Logs" to fetch.</p>
        </div>
    </div>

</div>

<!-- Optional template for JS rendering (if you prefer template cloning instead of string building) -->
<template id="admin-user-row-tpl">
<tr class="user-row">
    <td class="td-username" data-username=""></td>
    <td>
        <span class="masked-pass">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
        <div class="small-muted" style="margin-top:6px">Click eye to reset & view</div>
    </td>
    <td>
        <select class="role-select user-role-select" data-user-id="">
            <option value="user">user</option>
            <option value="editor">editor</option>
            <option value="admin">admin</option>
        </select>
    </td>
    <td class="td-modifiedAt"></td>
    <td>
        <div class="action-inline">
            <button class="btn-set-password" title="Set Password" data-user-id="">Set</button>
            <button class="btn-reset-password" title="Reset & View Password" data-user-id="">üëÅ</button>
            <button class="btn-edit-user" title="Edit User" data-user-id="">Edit</button>
            <button class="btn-delete-user btn-danger" title="Delete User" data-user-id="">Delete</button>
        </div>
    </td>
</tr>
</template>