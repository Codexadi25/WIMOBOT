<div class="panel-header">
    <h2>Messages</h2>
    <% if (user.role === 'admin' || user.role === 'editor') { %>
        <button id="btn-create-message" class="action-btn">Broadcast Message</button>
    <% } %>
</div>

<div class="content-panel-grid">
    <div class="message-filters">
        <div class="filter-group">
            <label for="message-type-filter">Type:</label>
            <select id="message-type-filter">
                <option value="">All Types</option>
                <option value="announcement">Announcement</option>
                <option value="maintenance">Maintenance</option>
                <option value="update">Update</option>
                <option value="warning">Warning</option>
                <option value="info">Info</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="message-priority-filter">Priority:</label>
            <select id="message-priority-filter">
                <option value="">All Priorities</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
            </select>
        </div>
        <button id="clear-message-filters" class="clear-filters-btn">Clear Filters</button>
    </div>
    
    <div class="scroll-area">
        <div id="message-list-container">
            <div class="loading-indicator">Loading messages...</div>
        </div>
    </div>
</div>

<!-- Message Creation Modal (Admin Only) -->
<% if (user.role === 'admin') { %>
<div id="message-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content large-modal">
        <button class="modal-close-btn" id="close-message-modal">&times;</button>
        <h3 id="message-modal-title">Broadcast Message</h3>
        <form id="message-form">
            <div class="form-group">
                <label for="message-title">Title *</label>
                <input type="text" id="message-title" name="title" required maxlength="200" placeholder="Message title">
            </div>
            <div class="form-group">
                <label for="message-content">Content *</label>
                <textarea id="message-content" name="content" required maxlength="2000" rows="6" placeholder="Message content"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="message-type">Type</label>
                    <select id="message-type" name="type">
                        <option value="info">Info</option>
                        <option value="announcement">Announcement</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="update">Update</option>
                        <option value="warning">Warning</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message-priority">Priority</label>
                    <select id="message-priority" name="priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="message-end-date">End Date & Time *</label>
                <input type="datetime-local" id="message-end-date" name="endDate" required>
            </div>
            <div class="form-group">
                <label>Target Audience</label>
                <div class="target-options">
                    <label>
                        <input type="checkbox" id="target-all" checked>
                        All Users
                    </label>
                    <div id="role-targets" style="margin-top: 10px;">
                        <label><input type="checkbox" name="targetRoles" value="user"> Users</label>
                        <label><input type="checkbox" name="targetRoles" value="editor"> Editors</label>
                        <label><input type="checkbox" name="targetRoles" value="admin"> Admins</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="message-specific-users">Specific Users (optional)</label>
                <select id="message-specific-users" name="targetUsers" multiple>
                    <!-- Populated by JavaScript -->
                </select>
                <small>Hold Ctrl/Cmd to select multiple users</small>
            </div>
            <div class="form-actions">
                <button type="button" id="cancel-message" class="btn-secondary">Cancel</button>
                <button type="submit" class="action-btn">Broadcast Message</button>
            </div>
        </form>
    </div>
</div>
<% } %>

<script src="/js/messages.js"></script>

